<ng-template #dialog let-data let-ref="dialogRef">
  <nb-card>
    <nb-card-header>
      {{ title }} Board
      <i class="nb-close" (click)="ref.close()"></i>
    </nb-card-header>
    <nb-card-body>
      <nb-stepper orientation="horizontal">
        <nb-step label="Details" [stepControl]="form">
          <form [formGroup]="form">
            <div class="form-group">
              <label for="title">Title</label>
              <input type="text" formControlName="title" fullWidth shape="semi-round" nbInput placeholder="Title">
              <div *ngIf="form.controls['title'].invalid && form.controls['title'].dirty">
                <small *ngIf="form.controls['title'].hasError('required')" class="text-danger">Field is required!</small>
              </div>
            </div>
            <div class="form-group row">
              <div class="col">
                <label for="title">Start Date</label>
                <input nbInput formControlName="startDate" fullWidth [nbDatepicker]="startDateControl" shape="semi-round">
                <nb-datepicker #startDateControl (dateChange)="changeMinDate($event)" [max]="maxDate"></nb-datepicker>
              </div>
              <div class="col">
                <label for="title">End Date</label>
                <input nbInput formControlName="endDate" fullWidth [nbDatepicker]="endDateControl" shape="semi-round">
                <nb-datepicker #endDateControl (dateChange)="changeMaxDate($event)" [min]="minDate"></nb-datepicker>
              </div>
            </div>
            <div class="form-group">
              <label for="title">Assaigned Users</label>
              <tag-input formControlName="assignedUsers" [theme]="'foundation-theme'" [onlyFromAutocomplete]="true"
                [modelAsStrings]="false">
                <tag-input-dropdown [showDropdownIfEmpty]="true" [autocompleteItems]="requestAutocompleteItems"
                  [zIndex]="1100">
                </tag-input-dropdown>
              </tag-input>
            </div>
            <!-- <div class="form-group">
                <label for="title">Owner</label>
                <input type="text" formControlName="owner" fullWidth shape="semi-round" nbInput readonly>
              </div> -->
          </form>
          <button nbButton nbStepperNext [disabled]="!this.form.valid" style="margin-top: 20px; margin-right: 10px;">next</button>
        </nb-step>
        <nb-step label="Layout">
          <form [formGroup]="layoutForm">
            <div class="form-group" style="margin-top: 10px;">
              <button nbButton (click)="addField()" style="margin-right: 10px;">Add Column</button>
              <button nbButton (click)="deleteField()" [disabled]="layoutForm.controls['fields'].controls.length <= 1">Remove
                Column</button>
            </div>
            <div class="columnFields">
              <!-- <div formArrayName="fields"> -->
              <span class="col" style="color: red; display: none;"><strong>Warning!</strong> The column can not have
                that name.</span>
              <table id="addTableTab" class="col">
                <thead style="margin-bottom: 10px;">
                  <tr>
                    <th>No.</th>
                    <th>Column Name</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container formArrayName="fields">
                    <tr *ngFor="let field of layoutForm.controls['fields'].controls; let i = index">
                      <td>{{ i + 1 }}</td>
                      <ng-container [formGroupName]="i">
                        <td><input nbInput formControlName="colName" shape="semi-round" fullWidth /></td>
                      </ng-container>
                    </tr>
                  </ng-container>
                </tbody>
              </table>
              <!-- </div> -->
            </div>
          </form>
          <div style="margin-top: 30px;">
            <button nbButton nbStepperPrevious style="margin-right: 10px;">prev</button>
            <button nbButton nbStepperNext [disabled]="layoutForm.controls['fields'].controls.length < 4 || !layoutForm.valid">next</button>
          </div>
        </nb-step>
        <nb-step label="Confirmation">
          <p>Please confirm configuration of your project:</p>
          <table class="confirmationTable">
            <tbody>
              <tr>
                <td><strong>Title</strong></td>
                <td>{{ form.controls['title'].value }}</td>
              </tr>
              <tr>
                <td><strong>Owner</strong></td>
                <td>{{ form.controls['owner'].value }}</td>
              </tr>
              <tr>
                <td><strong>Assigned Users</strong></td>
                <td>
                  <ng-container *ngFor="let user of form.controls['assignedUsers'].value">
                    {{ user.display }},
                  </ng-container>
                </td>
              </tr>
              <tr>
                <td><strong>Start Date</strong></td>
                <td>{{ form.controls['startDate'].value | date }}</td>
              </tr>
              <tr>
                <td><strong>End Date</strong> </td>
                <td>{{ form.controls['endDate'].value | date }}</td>
              </tr>
              <tr>
                <td><strong>Columns</strong></td>
                <td>
                  <ng-container *ngFor="let col of layoutForm.controls['fields'].value">
                    {{ col.colName }},
                  </ng-container>
                </td>
              </tr>
            </tbody>
          </table>
          <button nbButton nbStepperPrevious style="margin-right: 10px;">prev</button>
          <button nbButton (click)="submit()">Submit and Close</button>
          <!-- <button nbButton (click)="submit()">Submit</button> -->
          <!-- <button nbButton (click)="form.reset()">Reset</button> -->
        </nb-step>
      </nb-stepper>
    </nb-card-body>
  </nb-card>
</ng-template>
<span (click)="open(dialog)">{{ title }}</span>
